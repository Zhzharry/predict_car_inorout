# 纯GNN实现地库坡道场景识别的完整执行提纲
## 一、任务核心锚定：纯GNN的适配性与目标
### （一）核心定位
摒弃传统时序模型（GRU/1D-CNN）和Transformer，完全基于图神经网络（GNN）实现“进地库坡道/出地库坡道/其他区域”三分类，核心利用GNN对多传感器非欧几里得关联特征的捕捉能力，同时满足实时检测的时延、计算效率、模型大小约束。
### （二）量化目标
1. 准确率：出/入库前20秒至完全出/入库后40秒内检测成功率≥90%；
2. 检测时延：以完全出/入库为基准，单样本推理时延＜1秒（含图构建+GNN前向计算）；
3. 计算效率：CPU端单样本推理FLOPs＜10^6，内存占用＜512MB；
4. 模型大小：参数量＜100K，模型文件（INT8量化后）＜500KB。

## 二、传感器数据的图结构全链路设计（纯GNN适配）
### （一）图构建原则
所有输入特征均以图结构表征，不引入时序序列/张量等非图格式，确保端到端GNN处理。
### （二）节点设计（双维度节点体系）
1. **基础时序-特征融合节点**（核心）
   - 节点粒度：按“时间步+传感器维度”拆分，如t1时刻加速度x轴、t1时刻光照、t2时刻磁场强度等，每个节点唯一对应“某一时刻的某一类传感器特征”；
   - 节点特征：原始传感器数据经SVD降噪后的单维度值（仅保留该节点对应传感器维度的特征，无多维度拼接）。
2. **聚合节点（可选，轻量化）**
   - 按时间步构建聚合节点（如t1时刻总节点、t2时刻总节点），特征为该时间步所有传感器特征的SVD主成分，用于简化图结构，降低计算量。
### （三）边设计（全关联有向边，适配实时性）
1. **时序依赖边**：同传感器维度下，前序时间步节点指向后序时间步节点（如t1加速度x→t2加速度x），边权重为相邻时间步特征的皮尔逊相关系数（通过LU分解快速求解相关矩阵，降低权重计算耗时）；
2. **特征关联边**：同时间步下，不同传感器维度节点间构建无向边（如t1加速度z↔t1光照），边权重为该时间步两传感器特征的互信息值（通过QR分解筛选权重＞0.1的关键边，剪枝冗余关联）；
3. **约束**：仅保留当前及历史节点的边，禁止引入未来节点的边，确保不依赖未来数据。
### （四）图的动态更新（适配滑动窗口推理）
1. 窗口长度：固定20~30个时间步（对应2~3秒传感器数据），步长1个时间步；
2. 更新策略：每新增1个时间步，仅添加该时间步的节点及与前一窗口内节点的关联边，复用历史节点特征，避免全图重构。

## 三、纯GNN模型架构设计（轻量化+实时性优先）
### （一）核心GNN选型（单模型落地，无混合架构）
优先选择**轻量级图卷积网络（GCN）** 或**图注意力网络（GAT，单头注意力）**，二者均满足纯GNN要求，且适配车载实时场景：
| 模型类型       | 架构设计要点                                                                 |
|----------------|------------------------------------------------------------------------------|
| 轻量GCN        | 1. 层数：仅2层（输入层+输出层），无中间隐藏层堆叠；<br>2. 维度：输入维度=节点特征维度（1维），隐藏维度=32，输出维度=3（三分类）；<br>3. 聚合方式：均值聚合，简化计算。 |
| 单头轻量GAT    | 1. 层数：2层，仅1个头注意力，避免多头注意力的高计算量；<br>2. 注意力机制：仅计算相邻节点（时序/特征边连接的节点）的注意力，不做全局注意力；<br>3. 激活函数：ReLU，替换复杂激活（如GELU）。 |
### （二）模型轻量化极致优化（纯GNN专属）
1. **图卷积算子优化**：将卷积核大小限定为1（仅聚合直接相连的节点），避免多阶邻居聚合增加计算量；
2. **权重共享**：时序边对应的卷积权重全局共享，减少参数量；
3. **无批归一化/ dropout**：移除冗余层，仅保留卷积层+全连接层（输出分类），降低推理时延；
4. **量化压缩**：训练后直接做INT8量化，将图卷积权重、注意力权重量化为8位整数，模型大小压缩75%。

## 四、预处理：矩阵分解赋能纯GNN（无其他算法介入）
### （一）SVD：节点特征降噪（纯GNN输入前置）
对原始传感器单维度数据做SVD分解，保留95%方差的主成分，仅将降噪后的单维度值作为节点特征，避免噪声干扰GCN/GAT的聚合效果。
### （二）QR分解：边剪枝（纯GNN图结构优化）
对全时间步的特征关联矩阵做QR分解，通过正交矩阵Q筛选出与分类标签强相关的特征关联边（权重＞0.1），仅保留这些边，减少GNN聚合的节点数量，降低计算量。
### （三）LU分解：边权重快速求解（纯GNN计算效率提升）
对时序相关矩阵做LU分解，将矩阵求逆/乘法拆解为下三角（L）和上三角（U）矩阵运算，边权重计算耗时降低60%，适配实时图更新。

## 五、纯GNN模型训练（全流程无其他算法）
### （一）数据集处理
1. 按时间序列划分训练/验证/测试集（训练集：70%，验证集：15%，测试集：15%），避免数据泄露；
2. 所有样本均转换为图格式，标签关联至图的全局节点（即整图对应一个分类标签：进地库/出地库/其他）。
### （二）训练策略
1. 损失函数：交叉熵损失（适配三分类），仅加入L2正则化（防止GNN过拟合），无其他损失项；
2. 优化器：Adam优化器，学习率1e-4，batch_size=8~16（适配车载终端内存）；
3. 训练停止条件：验证集准确率连续5个epoch无提升，或达到目标准确率（≥90%）。
### （三）训练监控
重点监控：每轮训练的图构建耗时、GNN前向/反向计算耗时，确保训练过程中计算效率符合部署要求。

## 六、纯GNN实时推理部署（端到端图处理）
### （一）推理流程（无非GNN步骤）
1. 实时采集传感器数据→SVD降噪→构建新增节点；
2. 基于LU分解计算新增节点与历史节点的边权重，基于QR分解剪枝冗余边；
3. 轻量GCN/GAT聚合图特征→输出分类结果；
4. 检测触发：连续5个时间步预测为同一类别（进/出地库）时，判定检测成功。
### （二）部署优化（纯GNN适配）
1. 模型导出：将GNN导出为ONNX格式，仅保留图卷积/注意力算子，移除训练相关算子；
2. 硬件加速：CPU端用MKL加速图矩阵运算，GPU端用CUDA优化图卷积并行计算；
3. 内存优化：仅缓存当前窗口内的图节点/边数据，历史窗口数据及时释放，内存占用＜512MB。

## 七、纯GNN性能验证与分析（对齐任务指标）
### （一）核心指标验证
1. **准确率**：统计测试集中“出/入库前20秒至完全出/入库后40秒”的检测成功率，分析GNN对多传感器关联特征的捕捉效果；
2. **检测时延**：拆解时延构成（图构建耗时+GNN推理耗时），分别优化；
3. **计算效率**：统计单样本推理的FLOPs、CPU占用率，对比纯GNN与理论基线（如GRU）的差异；
4. **模型大小**：统计参数量、量化后模型文件大小，验证是否满足＜500KB的目标。
### （二）消融实验（纯GNN内部验证）
1. 验证图结构设计：对比“仅有时序边”“仅有特征关联边”“全边”三种图结构下的准确率/时延；
2. 验证矩阵分解作用：对比“无SVD/QR/LU”“仅SVD”“全矩阵分解”下的GNN性能；
3. 验证模型轻量化：对比“2层GCN”“1层GCN”“量化/未量化”的性能差异。

## 八、纯GNN的优化迭代方向
1. 动态图剪枝：基于强化学习（仍嵌入GNN框架）自适应剪枝低权重边，进一步降低计算量；
2. 图采样优化：采用随机邻居采样（SAGE采样），仅聚合部分关键节点，减少GNN聚合耗时；
3. 专用算子开发：针对车载终端CPU架构，定制GCN/GAT卷积算子，提升推理速度；
4. 多尺度图构建：构建“细粒度（时间步+传感器）+粗粒度（时间窗+传感器组）”双层图，平衡准确率与时延。